<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CYBER_CULTIVATION // SYSTEM_V3</title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=ZCOOL+KuaiLe&display=swap" rel="stylesheet">
    <style>
        :root {
            /* 磁带未来主义配色：琥珀色 (Amber) */
            --bg-color: #050505;
            --panel-bg: #111;
            --amber-bright: #ffb000; 
            --amber-dim: #594000;
            --amber-dark: #221800;
            --alert-red: #ff3300;
            
            --font-ui: 'Share Tech Mono', monospace;
            --font-text: 'ZCOOL KuaiLe', monospace;
        }

        * { box-sizing: border-box; }

        body {
            background-color: var(--bg-color);
            color: var(--amber-bright);
            font-family: var(--font-ui);
            margin: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* 全屏 CRT 扫描线特效 */
        body::after {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%),
                        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 4px, 6px 100%;
            pointer-events: none;
            z-index: 999;
        }

        /* --- 顶部状态栏 --- */
        header {
            height: 40px;
            background: var(--amber-dark);
            border-bottom: 2px solid var(--amber-dim);
            display: flex;
            align-items: center;
            padding: 0 20px;
            justify-content: space-between;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* --- 主界面布局 (左右分栏) --- */
        #main-console {
            flex: 1;
            display: flex;
            height: calc(100vh - 40px);
        }

        /* 左侧：视觉监视器 (Visual Monitor) */
        #monitor-sector {
            flex: 6; /* 占据 60% 宽度 */
            position: relative;
            border-right: 3px solid var(--amber-dim);
            background: radial-gradient(circle at 50% 50%, #1a1200 0%, #000 120%);
            display: flex;
            flex-direction: column;
        }

        #monitor-label {
            position: absolute;
            top: 10px; left: 10px;
            background: var(--amber-bright);
            color: #000;
            padding: 2px 8px;
            font-size: 12px;
            font-weight: bold;
        }

        /* 画布自动填充左侧 */
        canvas {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: blur(0.5px) contrast(1.2);
        }

        /* 右侧：数据与控制 (Data & Control) */
        #control-sector {
            flex: 4; /* 占据 40% 宽度 */
            display: flex;
            flex-direction: column;
            padding: 20px;
            background: #0a0a0a;
            box-shadow: inset 10px 0 20px rgba(0,0,0,0.5);
        }

        /* 剧情文本区 */
        #log-display {
            flex: 1;
            border: 1px solid var(--amber-dim);
            background: rgba(0,0,0,0.3);
            padding: 15px;
            font-family: var(--font-text);
            font-size: 1.3rem;
            line-height: 1.6;
            overflow-y: auto;
            color: #ddd;
            text-shadow: 0 0 5px var(--amber-dim);
            margin-bottom: 20px;
        }
        
        #log-display::-webkit-scrollbar { width: 5px; }
        #log-display::-webkit-scrollbar-thumb { background: var(--amber-dim); }

        .highlight { color: var(--amber-bright); font-weight: bold; text-decoration: underline; }
        .glitch { animation: glitch 0.3s infinite; color: var(--alert-red); display: inline-block; }
        @keyframes glitch { 0% { transform: translate(1px,0); } 50% { transform: translate(-1px,0); } 100% { transform: translate(0,0); } }

        /* 互动按钮区 */
        #action-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        button {
            background: transparent;
            border: 2px solid var(--amber-dim);
            color: var(--amber-bright);
            padding: 15px;
            font-family: var(--font-ui);
            font-size: 1rem;
            text-transform: uppercase;
            cursor: pointer;
            transition: 0.2s;
            text-align: left;
            position: relative;
        }
        
        button:hover {
            background: var(--amber-bright);
            color: #000;
            box-shadow: 0 0 15px var(--amber-bright);
        }

        button:active { transform: translateY(2px); }

        button.locked { opacity: 0.5; border-style: dashed; cursor: not-allowed; }

        /* 底部：磁带播放器 UI */
        #tape-deck {
            border-top: 2px dashed var(--amber-dim);
            padding-top: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 0.8rem;
        }

        .tape-controls button {
            padding: 5px 10px;
            font-size: 0.8rem;
            width: auto;
            display: inline-block;
        }

        #audio-visualizer {
            display: flex;
            gap: 2px;
            height: 20px;
            align-items: flex-end;
        }
        .bar { width: 4px; background: var(--amber-bright); animation: bounce 0.5s infinite; }
        @keyframes bounce { 0%, 100% { height: 2px; } 50% { height: 15px; } }

    </style>
</head>
<body>

    <header>
        <span>SYS.DATE: 9999.12.31</span>
        <span>UNIT: 302-B</span>
        <span class="blink">STATUS: UNSTABLE</span>
    </header>

    <div id="main-console">
        <div id="monitor-sector">
            <div id="monitor-label">CAM_01 // LIVE FEED</div>
            <canvas id="game-canvas"></canvas>
        </div>

        <div id="control-sector">
            <div style="margin-bottom: 10px; color: var(--amber-dim);">>> SYSTEM LOG:</div>
            
            <div id="log-display">
                <p>正在连接神经接口...</p>
                <p>等待操作员指令。</p>
            </div>

            <div id="action-panel">
                </div>

            <div id="tape-deck">
                <div style="display:flex; flex-direction:column;">
                    <span>BGM: <span id="bgm-status">OFFLINE</span></span>
                    <div id="audio-visualizer" style="opacity:0;">
                        <div class="bar" style="animation-duration:0.4s"></div>
                        <div class="bar" style="animation-duration:0.6s"></div>
                        <div class="bar" style="animation-duration:0.3s"></div>
                        <div class="bar" style="animation-duration:0.5s"></div>
                    </div>
                </div>
                <div class="tape-controls">
                    <button id="btn-audio" onclick="AudioSys.toggle()">[INSERT TAPE]</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. 程序化绘图引擎 (No Images Needed!) ---
        const ArtSys = {
            canvas: document.getElementById('game-canvas'),
            ctx: null,
            sceneType: 'static', // static, doctor, corridor, monster

            init() {
                this.ctx = this.canvas.getContext('2d');
                window.addEventListener('resize', () => this.resize());
                this.resize();
                this.loop();
            },

            resize() {
                this.canvas.width = this.canvas.parentElement.clientWidth;
                this.canvas.height = this.canvas.parentElement.clientHeight;
            },

            drawGrid(ctx, w, h) {
                // 绘制透视网格 (Retro Grid)
                ctx.strokeStyle = 'rgba(255, 176, 0, 0.2)';
                ctx.lineWidth = 1;
                ctx.beginPath();
                // 地面线
                for(let i=0; i<w; i+=80) {
                    ctx.moveTo(i, h/2); ctx.lineTo(i-w/2, h);
                }
                // 横线
                for(let j=h/2; j<h; j+=40) {
                    ctx.moveTo(0, j); ctx.lineTo(w, j);
                }
                ctx.stroke();
            },

            drawDoctor(ctx, w, h) {
                // 用简单的几何图形画一个诡异的医生
                ctx.strokeStyle = '#ffb000';
                ctx.lineWidth = 3;
                
                const cx = w/2;
                const cy = h/2 + 50;

                // 头 (方形)
                ctx.strokeRect(cx - 40, cy - 150, 80, 80);
                // 眼睛 (X)
                ctx.beginPath();
                ctx.moveTo(cx-20, cy-130); ctx.lineTo(cx-10, cy-120);
                ctx.moveTo(cx-10, cy-130); ctx.lineTo(cx-20, cy-120);
                ctx.moveTo(cx+20, cy-130); ctx.lineTo(cx+30, cy-120);
                ctx.moveTo(cx+30, cy-130); ctx.lineTo(cx+20, cy-120);
                ctx.stroke();

                // 身体 (大褂)
                ctx.beginPath();
                ctx.moveTo(cx, cy-70);
                ctx.lineTo(cx-60, cy+100);
                ctx.lineTo(cx+60, cy+100);
                ctx.lineTo(cx, cy-70);
                ctx.stroke();

                // 手里的电锯 (矩形+锯齿)
                ctx.fillStyle = '#ff3300';
                ctx.fillRect(cx+60, cy-20, 100, 30);
                ctx.fillStyle = '#ffb000';
            },

            drawMonster(ctx, w, h) {
                // 乱码风格的怪物
                const cx = w/2;
                const cy = h/2;
                ctx.strokeStyle = '#ff3300';
                ctx.beginPath();
                for(let i=0; i<50; i++) {
                    ctx.moveTo(cx, cy);
                    ctx.lineTo(cx + Math.random()*200 - 100, cy + Math.random()*200 - 100);
                }
                ctx.stroke();
                
                // 大眼睛
                ctx.beginPath();
                ctx.arc(cx, cy, 30, 0, Math.PI*2);
                ctx.fillStyle = '#ff3300';
                ctx.fill();
            },

            loop() {
                const ctx = this.ctx;
                const w = this.canvas.width;
                const h = this.canvas.height;
                const time = Date.now() * 0.002;

                // 清屏 (带残影)
                ctx.fillStyle = 'rgba(5, 5, 5, 0.2)';
                ctx.fillRect(0, 0, w, h);

                // 绘制背景网格
                this.drawGrid(ctx, w, h);

                // 根据场景绘制物体
                if (this.sceneType === 'doctor') {
                    this.drawDoctor(ctx, w, h);
                } else if (this.sceneType === 'monster') {
                    this.drawMonster(ctx, w, h);
                } else if (this.sceneType === 'static') {
                    // 雪花噪点
                    ctx.fillStyle = '#ffb000';
                    for(let i=0; i<100; i++) {
                        ctx.fillRect(Math.random()*w, Math.random()*h, 2, 2);
                    }
                }

                requestAnimationFrame(() => this.loop());
            }
        };

        // --- 2. 磁带音频系统 (Audio System) ---
        const AudioSys = {
            ctx: null,
            isPlaying: false,
            osc: null,
            
            toggle() {
                if (!this.isPlaying) {
                    this.play();
                } else {
                    this.stop();
                }
            },

            play() {
                // 初始化 AudioContext
                if (!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                
                // 创建低频嗡嗡声 (Drone)
                this.osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                
                this.osc.type = 'sawtooth';
                this.osc.frequency.setValueAtTime(50, this.ctx.currentTime); // 50Hz 底噪
                
                // 低通滤波，让声音听起来像隔着墙
                const filter = this.ctx.createBiquadFilter();
                filter.type = 'lowpass';
                filter.frequency.value = 200;

                gain.gain.value = 0.1; // 音量

                this.osc.connect(filter);
                filter.connect(gain);
                gain.connect(this.ctx.destination);
                this.osc.start();

                this.isPlaying = true;
                document.getElementById('bgm-status').innerText = "PLAYING >>";
                document.getElementById('btn-audio').innerText = "[EJECT TAPE]";
                document.getElementById('audio-visualizer').style.opacity = 1;
            },

            stop() {
                if(this.osc) {
                    this.osc.stop();
                    this.osc = null;
                }
                this.isPlaying = false;
                document.getElementById('bgm-status').innerText = "PAUSED ||";
                document.getElementById('btn-audio').innerText = "[RESUME]";
                document.getElementById('audio-visualizer').style.opacity = 0;
            },

            playClick() {
                // 按钮点击音效
                if (!this.ctx) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = 'square';
                osc.frequency.value = 800;
                gain.gain.value = 0.05;
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                osc.stop(this.ctx.currentTime + 0.05);
            }
        };

        // --- 3. 游戏剧情逻辑 ---
        const Game = {
            san: 100,
            inventory: [],
            
            start() {
                ArtSys.init();
                this.loadScene('intro');
            },

            loadScene(id) {
                const scene = scenes[id];
                const log = document.getElementById('log-display');
                const panel = document.getElementById('action-panel');

                // 1. 切换视觉
                ArtSys.sceneType = scene.visual || 'static';

                // 2. 更新文本 (追加模式)
                log.innerHTML += `<div style="margin-top:20px; border-top:1px dashed #333; padding-top:10px;">${scene.text}</div>`;
                log.scrollTop = log.scrollHeight; // 自动滚动到底部

                // 3. 生成按钮
                panel.innerHTML = '';
                scene.choices.forEach(c => {
                    const btn = document.createElement('button');
                    btn.innerHTML = `> ${c.text}`;
                    
                    // 检查条件
                    if (c.cond && !c.cond()) {
                        btn.classList.add('locked');
                        btn.innerHTML += " [条件不足]";
                        btn.disabled = true;
                    }

                    btn.onclick = () => {
                        AudioSys.playClick();
                        if (c.effect) c.effect(); // 执行副作用（扣血、拿道具）
                        this.loadScene(c.next);
                    };
                    panel.appendChild(btn);
                });
            }
        };

        // --- 剧本数据 ---
        const scenes = {
            'intro': {
                text: "系统启动... 日期 9999.12.31。<br>你醒了。这里是第4号手术室。<br><br>左侧检测到威胁：<span class='highlight'>[主治医师]</span>。<br>他手里拿着一颗正在跳动的<span class='glitch'>[眼球]</span>，并称之为‘金丹’。",
                visual: 'doctor',
                choices: [
                    { text: "大声呼救", next: 'scream' },
                    { text: "询问保修期 (幽默)", next: 'humor' },
                    { text: "分析物体结构 (SAN -20)", next: 'analyze' }
                ]
            },
            'scream': {
                text: "警告：心率过载！<br>医生叹了口气：“又是废品。”<br>视线变黑...<br>BAD END: 废弃处理。",
                visual: 'static',
                choices: [
                    { text: "重启系统", next: 'intro' }
                ]
            },
            'humor': {
                text: "你激活了[认知滤网]。<br>医生变成了一只泰迪熊。<br>你吞下了‘荔枝味’的金丹。<br>状态：存活。",
                visual: 'static',
                effect: () => { Game.san -= 10; },
                choices: [
                    { text: "走出手术室", next: 'corridor' }
                ]
            },
            'analyze': {
                text: "分析完成。<br>解析到摩尔斯电码：'CUT THE RED WIRE'。<br>你发现医生手腕上有一根裸露的红线。",
                visual: 'doctor',
                effect: () => { Game.san -= 20; },
                choices: [
                    { text: "切断红线", next: 'win_fight' },
                    { text: "我不敢...", next: 'scream' }
                ]
            },
            'win_fight': {
                text: "目标解体。<br>获得物品：<span class='highlight'>[真视之眼]</span>。<br>你现在的视界不同了。",
                visual: 'static',
                effect: () => { Game.inventory.push('eye'); },
                choices: [
                    { text: "离开房间", next: 'corridor' }
                ]
            },
            'corridor': {
                text: "走廊里弥漫着消毒水和机油的味道。<br>前方有一道视网膜扫描门。",
                visual: 'static',
                choices: [
                    { 
                        text: "使用[真视之眼]开门", 
                        next: 'secret',
                        cond: () => Game.inventory.includes('eye')
                    },
                    { text: "强行撞门", next: 'scream' },
                    { text: "在地上爬行 (装疯)", next: 'crawl' }
                ]
            },
            'crawl': {
                text: "你像虫子一样爬过了安检。<br>虽然丢人，但有效。<br>SAN值大幅下降。",
                visual: 'monster',
                effect: () => { Game.san -= 50; },
                choices: [
                    { text: "继续前进", next: 'secret' }
                ]
            },
            'secret': {
                text: "你进入了核心机房。<br>恭喜，你是第9999个到达这里的‘病人’。<br>（演示结束，等待更新）",
                visual: 'static',
                choices: [
                    { text: "重置模拟", next: 'intro' }
                ]
            }
        };

        // 启动
        Game.start();

    </script>
</body>
</html>
